INFO:     Will watch for changes in these directories: ['/home/thaianh/Workspace/chat-assistant']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [12041] using StatReload
INFO:     Started server process [12043]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     127.0.0.1:43650 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:43652 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:41866 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:41874 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:50430 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:50446 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:50458 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:49622 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:39724 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:39730 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:39738 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:39742 - "POST /chat HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'app/schemas.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [12043]
INFO:     Started server process [13364]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'app/services/memory.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [13364]
INFO:     Started server process [13378]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'app/services/processor.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [13378]
INFO:     Started server process [13384]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'client_demo.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [13384]
INFO:     Started server process [13401]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     127.0.0.1:48004 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:56412 - "POST /chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:56418 - "POST /chat HTTP/1.1" 200 OK
ERROR:    ‚ùå Query Understanding failed: Error calling model 'gemini-2.5-flash-lite' (RESOURCE_EXHAUSTED): 429 RESOURCE_EXHAUSTED. {'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 20, model: gemini-2.5-flash-lite\nPlease retry in 23.211320205s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.5-flash-lite'}, 'quotaValue': '20'}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '23s'}]}}
WARNING:  StatReload detected changes in 'app/main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for connections to close. (CTRL+C to force quit)
INFO:     127.0.0.1:56420 - "POST /chat HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/langchain_google_genai/chat_models.py", line 3088, in _agenerate
    await self.client.aio.models.generate_content(
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/google/genai/models.py", line 7042, in generate_content
    response = await self._generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/google/genai/models.py", line 5848, in _generate_content
    response = await self._api_client.async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/google/genai/_api_client.py", line 1432, in async_request
    result = await self._async_request(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/google/genai/_api_client.py", line 1364, in _async_request
    return await retry(self._async_request_once, http_request, stream)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/tenacity/asyncio/__init__.py", line 111, in __call__
    do = await self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/tenacity/asyncio/__init__.py", line 153, in iter
    result = await action(retry_state)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/tenacity/_utils.py", line 99, in inner
    return call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/tenacity/__init__.py", line 418, in exc_check
    raise retry_exc.reraise()
          ^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/tenacity/__init__.py", line 185, in reraise
    raise self.last_attempt.result()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib64/python3.11/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib64/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/tenacity/asyncio/__init__.py", line 114, in __call__
    result = await fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/google/genai/_api_client.py", line 1310, in _async_request_once
    await errors.APIError.raise_for_async_response(response)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/google/genai/errors.py", line 203, in raise_for_async_response
    await cls.raise_error_async(status_code, response_json, response)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/google/genai/errors.py", line 225, in raise_error_async
    raise ClientError(status_code, response_json, response)
google.genai.errors.ClientError: 429 RESOURCE_EXHAUSTED. {'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 20, model: gemini-2.5-flash-lite\nPlease retry in 49.82735009s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.5-flash-lite'}, 'quotaValue': '20'}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '49s'}]}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 404, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/routing.py", line 762, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/routing.py", line 782, in app
    await route.handle(scope, receive, send)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/routing.py", line 297, in handle
    await self.app(scope, receive, send)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/starlette/routing.py", line 72, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/fastapi/routing.py", line 299, in app
    raise e
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/fastapi/routing.py", line 294, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/app/main.py", line 60, in chat_endpoint
    return {
             
  File "/home/thaianh/Workspace/chat-assistant/app/services/processor.py", line 89, in generate_final_answer
    return await chain.ainvoke({"context": augmented_context})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/langchain_core/runnables/base.py", line 3191, in ainvoke
    input_ = await coro_with_context(part(), context, create_task=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 425, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1132, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1090, in agenerate
    raise exceptions[0]
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1359, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/langchain_google_genai/chat_models.py", line 3093, in _agenerate
    _handle_client_error(e, request)
  File "/home/thaianh/Workspace/chat-assistant/venv/lib64/python3.11/site-packages/langchain_google_genai/chat_models.py", line 145, in _handle_client_error
    raise ChatGoogleGenerativeAIError(msg) from e
langchain_google_genai.chat_models.ChatGoogleGenerativeAIError: Error calling model 'gemini-2.5-flash-lite' (RESOURCE_EXHAUSTED): 429 RESOURCE_EXHAUSTED. {'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 20, model: gemini-2.5-flash-lite\nPlease retry in 49.82735009s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.5-flash-lite'}, 'quotaValue': '20'}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '49s'}]}}
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [13401]
INFO:     Started server process [13620]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'app/services/processor.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [13620]
INFO:     Started server process [13694]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'app/services/processor.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [13694]
INFO:     Started server process [13700]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'app/main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [13700]
INFO:     Started server process [13775]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
